"use strict";
Page({
    data: {
        active: 0,
        params: {
            query: '',
            cid: '',
            pagenum: 1,
            pagesize: 10,
        },
        hasMore: true,
        isLoading: false,
        goodsList: []
    },
    onLoad: function (options) {
        this.data.params.cid = options.cid || '';
        this.getGoodsList();
    },
    getGoodsList: function () {
        var _this = this;
        this.data.isLoading = true;
        getApp().request('/goods/search', this.data.params).then(function (res) {
            _this.data.isLoading = false;
            if (res.statusCode == 200) {
                _this.setData({ goodsList: _this.data.goodsList.concat(res.data.message.goods) });
                wx.stopPullDownRefresh();
                if (Math.ceil(res.data.message.total / _this.data.params.pagesize) > _this.data.params.pagenum) {
                    _this.data.params.pagenum += 1;
                }
                else {
                    _this.setData({ hasMore: false });
                }
            }
        });
    },
    onReady: function () {
    },
    onShow: function () {
    },
    onHide: function () {
    },
    onUnload: function () {
    },
    onPullDownRefresh: function () {
        this.setData({
            hasMore: true,
            isLoading: false,
            goodsList: []
        });
        this.data.params.pagenum = 1;
        this.getGoodsList();
    },
    onReachBottom: function () {
        if (this.data.hasMore && !this.data.isLoading) {
            this.getGoodsList();
        }
    },
    onShareAppMessage: function () {
        return {};
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsSUFBSSxDQUFDO0lBSUgsSUFBSSxFQUFFO1FBQ0osTUFBTSxFQUFFLENBQUM7UUFDVCxNQUFNLEVBQUU7WUFDTixLQUFLLEVBQUUsRUFBRTtZQUNULEdBQUcsRUFBRSxFQUFFO1lBQ1AsT0FBTyxFQUFFLENBQUM7WUFDVixRQUFRLEVBQUUsRUFBRTtTQUNiO1FBQ0QsT0FBTyxFQUFFLElBQUk7UUFDYixTQUFTLEVBQUUsS0FBSztRQUNoQixTQUFTLEVBQUUsRUFBRTtLQUNkO0lBSUQsTUFBTSxFQUFOLFVBQU8sT0FBTztRQUNaLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQTtRQUN4QyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUE7SUFDckIsQ0FBQztJQUNELFlBQVksRUFBWjtRQUFBLGlCQWdCQztRQWZDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQTtRQUMxQixNQUFNLEVBQUUsQ0FBQyxPQUFPLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsR0FBUTtZQUNoRSxLQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUE7WUFFM0IsSUFBSSxHQUFHLENBQUMsVUFBVSxJQUFJLEdBQUcsRUFBRTtnQkFDekIsS0FBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLFNBQVMsRUFBRSxLQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFBO2dCQUMvRSxFQUFFLENBQUMsbUJBQW1CLEVBQUUsQ0FBQTtnQkFDeEIsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxLQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxLQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUU7b0JBQzVGLEtBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUE7aUJBQzlCO3FCQUFNO29CQUNMLEtBQUksQ0FBQyxPQUFPLENBQUMsRUFBQyxPQUFPLEVBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQTtpQkFFOUI7YUFDRjtRQUNILENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUlELE9BQU8sRUFBUDtJQUVBLENBQUM7SUFLRCxNQUFNLEVBQU47SUFFQSxDQUFDO0lBS0QsTUFBTSxFQUFOO0lBRUEsQ0FBQztJQUtELFFBQVEsRUFBUjtJQUVBLENBQUM7SUFLRCxpQkFBaUIsRUFBakI7UUFDRSxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsT0FBTyxFQUFFLElBQUk7WUFDYixTQUFTLEVBQUUsS0FBSztZQUNoQixTQUFTLEVBQUUsRUFBRTtTQUNkLENBQUMsQ0FBQTtRQUNGLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUE7UUFDNUIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO0lBQ3JCLENBQUM7SUFLRCxhQUFhLEVBQWI7UUFFRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDN0MsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFBO1NBQ3BCO0lBQ0gsQ0FBQztJQUtELGlCQUFpQixFQUFqQjtRQUNFLE9BQU8sRUFBRSxDQUFBO0lBQ1gsQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIlBhZ2Uoe1xuICAvKipcbiAgICog6aG16Z2i55qE5Yid5aeL5pWw5o2uXG4gICAqL1xuICBkYXRhOiB7XG4gICAgYWN0aXZlOiAwLFxuICAgIHBhcmFtczoge1xuICAgICAgcXVlcnk6ICcnLFxuICAgICAgY2lkOiAnJyxcbiAgICAgIHBhZ2VudW06IDEsXG4gICAgICBwYWdlc2l6ZTogMTAsXG4gICAgfSxcbiAgICBoYXNNb3JlOiB0cnVlLFxuICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgZ29vZHNMaXN0OiBbXVxuICB9LFxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLliqDovb1cbiAgICovXG4gIG9uTG9hZChvcHRpb25zKTogdm9pZCB7XG4gICAgdGhpcy5kYXRhLnBhcmFtcy5jaWQgPSBvcHRpb25zLmNpZCB8fCAnJ1xuICAgIHRoaXMuZ2V0R29vZHNMaXN0KClcbiAgfSxcbiAgZ2V0R29vZHNMaXN0KCk6IHZvaWQge1xuICAgIHRoaXMuZGF0YS5pc0xvYWRpbmcgPSB0cnVlXG4gICAgZ2V0QXBwKCkucmVxdWVzdCgnL2dvb2RzL3NlYXJjaCcsIHRoaXMuZGF0YS5wYXJhbXMpLnRoZW4oKHJlczogYW55KSA9PiB7XG4gICAgICB0aGlzLmRhdGEuaXNMb2FkaW5nID0gZmFsc2VcblxuICAgICAgaWYgKHJlcy5zdGF0dXNDb2RlID09IDIwMCkge1xuICAgICAgICB0aGlzLnNldERhdGEoeyBnb29kc0xpc3Q6IHRoaXMuZGF0YS5nb29kc0xpc3QuY29uY2F0KHJlcy5kYXRhLm1lc3NhZ2UuZ29vZHMpIH0pXG4gICAgICAgIHd4LnN0b3BQdWxsRG93blJlZnJlc2goKVxuICAgICAgICBpZiAoTWF0aC5jZWlsKHJlcy5kYXRhLm1lc3NhZ2UudG90YWwgLyB0aGlzLmRhdGEucGFyYW1zLnBhZ2VzaXplKSA+IHRoaXMuZGF0YS5wYXJhbXMucGFnZW51bSkge1xuICAgICAgICAgIHRoaXMuZGF0YS5wYXJhbXMucGFnZW51bSArPSAxXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5zZXREYXRhKHtoYXNNb3JlOmZhbHNlfSlcbiAgICAgICAgIFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSxcbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5Yid5qyh5riy5p+T5a6M5oiQXG4gICAqL1xuICBvblJlYWR5KCk6IHZvaWQge1xuXG4gIH0sXG5cbiAgLyoqXG4gICAqIOeUn+WRveWRqOacn+WHveaVsC0t55uR5ZCs6aG16Z2i5pi+56S6XG4gICAqL1xuICBvblNob3coKTogdm9pZCB7XG5cbiAgfSxcblxuICAvKipcbiAgICog55Sf5ZG95ZGo5pyf5Ye95pWwLS3nm5HlkKzpobXpnaLpmpDol49cbiAgICovXG4gIG9uSGlkZSgpOiB2b2lkIHtcblxuICB9LFxuXG4gIC8qKlxuICAgKiDnlJ/lkb3lkajmnJ/lh73mlbAtLeebkeWQrOmhtemdouWNuOi9vVxuICAgKi9cbiAgb25VbmxvYWQoKTogdm9pZCB7XG5cbiAgfSxcblxuICAvKipcbiAgICog6aG16Z2i55u45YWz5LqL5Lu25aSE55CG5Ye95pWwLS3nm5HlkKznlKjmiLfkuIvmi4nliqjkvZxcbiAgICovXG4gIG9uUHVsbERvd25SZWZyZXNoKCk6IHZvaWQge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBoYXNNb3JlOiB0cnVlLFxuICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgIGdvb2RzTGlzdDogW11cbiAgICB9KVxuICAgIHRoaXMuZGF0YS5wYXJhbXMucGFnZW51bSA9IDFcbiAgICB0aGlzLmdldEdvb2RzTGlzdCgpXG4gIH0sXG5cbiAgLyoqXG4gICAqIOmhtemdouS4iuaLieinpuW6leS6i+S7tueahOWkhOeQhuWHveaVsFxuICAgKi9cbiAgb25SZWFjaEJvdHRvbSgpOiB2b2lkIHtcblxuICAgIGlmICh0aGlzLmRhdGEuaGFzTW9yZSAmJiAhdGhpcy5kYXRhLmlzTG9hZGluZykge1xuICAgICAgdGhpcy5nZXRHb29kc0xpc3QoKVxuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICog55So5oi354K55Ye75Y+z5LiK6KeS5YiG5LqrXG4gICAqL1xuICBvblNoYXJlQXBwTWVzc2FnZSgpOiBPYmplY3Qge1xuICAgIHJldHVybiB7fVxuICB9XG59KSJdfQ==